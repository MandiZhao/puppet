[global]
# ID of the ceph cluster
fsid = a910ccd1-1116-4873-b3f9-c2cb7eed4e56

# Initial ceph monitors
mon_host = <%= @ceph_mon_ip_str %>

# IP of current node, needed for monitor bootstraping
public_addr = <%= @ip_addr %>

# enable authentication by default
auth_cluster_required = cephx
auth_service_required = cephx
auth_client_required = cephx
auth_supported = cephx

# Write 3 replicas if possible
osd_pool_default_size = 2

# But be okay with writing one (bump when we have more nodes)
osd_pool_default_min_size = 1

# Allow pool deletion for debugging purposes
mon_allow_pool_delete = true

# Caluculated with the following algorithm
# https://stackoverflow.com/q/40771273
osd_pool_default_pg_num = 128
osd_pool_default_pgp_num = 128

# More initial ceph monitors
<% @ceph_mon_ips.each do |(hostname, ip)| %>
[mon.<%= hostname %>]
host = <%= hostname %>
mon addr = <%= ip %>:3300
<% end %>

<% @ceph_rgws.each do |(hostname, ip)| %>
[client.<%= hostname %>]
rgw_frontends = beast port=8080 ssl_port=8443 ssl_certificate=/etc/ssl/private/ceph.ocf.berkeley.edu.bundle ssl_private_key=/var/lib/lets-encrypt/certs/ceph.ocf.berkeley.edu/privkey.pem
<% end %>
